{% load static %} {% load humanize %} {% load custom_tags %} {% load humanize %}
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>{% block title %}Dashboard{% endblock %}</title>
        <link
            href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css"
            rel="stylesheet"
        />
        <script src="https://unpkg.com/htmx.org@1.9.11"></script>

        <meta
            content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
            name="viewport"
        />

        <link
            rel="icon"
            type="image/x-icon"
            href="{% static 'assets/img/logo_icon.png' %}"
        />
        <link
            rel="stylesheet"
            href="{% static 'assets/css/font-awesome.css' %}"
        />
        <link rel="stylesheet" href="{% static 'css/base.css' %}" />
        <script src="{% static 'assets/js/plugin/webfont/webfont.min.js' %}"></script>
        <script>
            WebFont.load({
                google: { families: ["Public Sans:300,400,500,600,700"] },
                custom: {
                    families: [
                        "Font Awesome 5 Solid",
                        "Font Awesome 5 Regular",
                        "Font Awesome 5 Brands",
                        "simple-line-icons",
                    ],
                    urls: ["{% static 'assets/css/fonts.min.css' %}"],
                },
                active: function () {
                    sessionStorage.fonts = true;
                },
            });
        </script>

        {% block styles %} {% endblock styles %}
        <!-- CSS Files -->
        <link
            rel="stylesheet"
            href="{% static 'assets/css/bootstrap.min.css' %}"
        />
        <link
            rel="stylesheet"
            href="{% static 'assets/css/plugins.min.css' %}"
        />
        <link
            rel="stylesheet"
            href="{% static 'assets/css/kaiadmin.min.css' %}"
        />

        <link rel="stylesheet" href="{% static 'assets/css/demo.css' %}" />
    </head>
    <body>
        <div class="wrapper">
            <!-- ======= Sidebar ======= -->
            {% include 'Base/sidebar.html' %}

            <!-- ======= Header ======= -->
            {% include 'Base/navbar.html' %}

            <div class="container">
                {% block main_block %} {% endblock main_block %}
            </div>
            <div id="loader-overlay" style="display: none">
                <div id="loader-spinner"></div>
            </div>
            {% include 'Base/footer.html' %}
        </div>

        <div
            class="toast-container position-fixed top-0 start-50 translate-middle-x p-3"
            id="toastContainer"
        >
            {% if messages %} {% for message in messages %}
            <div
                class="toast align-items-center text-bg-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} border-0 show"
                role="alert"
                data-toast-id="{{ forloop.counter }}"
            >
                <div class="d-flex">
                    <div class="toast-body d-flex align-items-center fs-5">
                        <!-- fs-5 for larger font size -->
                        {% if message.tags == 'error' %}
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="toast-icon"
                            fill="currentColor"
                            viewBox="0 0 16 16"
                            width="20"
                            height="20"
                        >
                            <path
                                d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
                            />
                            <path
                                d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"
                            />
                        </svg>
                        {% elif message.tags == 'success' %}
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="toast-icon"
                            fill="currentColor"
                            viewBox="0 0 16 16"
                            width="20"
                            height="20"
                        >
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
                            />
                        </svg>
                        {% endif %}
                        <span class="flex-grow-1">{{ message }}</span>
                    </div>
                    <button
                        type="button"
                        class="btn-close btn-close-white me-2 m-auto"
                        onclick="closeToast({{ forloop.counter }})"
                    ></button>
                </div>
                <div class="toast-progress">
                    <div class="toast-progress-bar"></div>
                </div>
            </div>
            {% endfor %} {% endif %}
        </div>

        <!--   Core JS Files   -->
        <script src="{% static 'assets/js/core/jquery-3.7.1.min.js' %}"></script>
        <script src="{% static 'assets/js/core/popper.min.js' %}"></script>
        <script src="{% static 'assets/js/core/bootstrap.min.js' %}"></script>
        <!-- jQuery Scrollbar -->
        <script src="{% static 'assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js' %}"></script>
        <!-- Chart JS -->
        {% comment %}
        <script src="assets/js/plugin/chart.js/chart.min.js"></script>
        {% endcomment %}
        <!-- jQuery Sparkline -->
        <script src="{% static 'assets/js/plugin/jquery.sparkline/jquery.sparkline.min.js' %}"></script>
        <!-- Chart Circle -->
        <script src="{% static 'assets/js/plugin/chart-circle/circles.min.js' %}"></script>
        <!-- Datatables -->
        <script src="{% static 'assets/js/plugin/datatables/datatables.min.js' %}"></script>
        <!-- Bootstrap Notify -->
        <script src="{% static 'assets/js/plugin/bootstrap-notify/bootstrap-notify.min.js' %}"></script>
        <!-- jQuery Vector Maps -->
        <script src="{% static 'assets/js/plugin/jsvectormap/jsvectormap.min.js' %}"></script>
        <script src="{% static 'assets/js/plugin/jsvectormap/world.js' %}"></script>
        <!-- Sweet Alert -->
        {% comment %}
        <script src="{% static 'assets/js/plugin/sweetalert/sweetalert.min.js' %}"></script>
        {% endcomment %}
        <!-- Kaiadmin JS -->
        <script src="{% static 'assets/js/kaiadmin.min.js' %}"></script>

        <script>
            // Check internet connectivity on page load
            if (!navigator.onLine) {
                window.location.href = "{% url 'offline-page' %}"; // Redirect to offline error page
            }

            // Listen for online/offline events
            window.addEventListener('offline', function() {
                window.location.href = "{% url 'offline-page' %}"; // Redirect on going offline
            });

            window.addEventListener('online', function() {

                window.location.href = "{% url "login_page" %}";
            });
        </script>
        <script>
            function closeToast(id) {
                const toast = document.querySelector(`[data-toast-id="${id}"]`);
                if (toast) {
                    toast.classList.add("hide");
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                            s;
                        }
                    }, 300);
                }
            }

            document.addEventListener("DOMContentLoaded", function () {
                const toasts = document.querySelectorAll(
                    ".toast[data-toast-id]"
                );
                toasts.forEach((toast, index) => {
                    const id = toast.getAttribute("data-toast-id");
                    setTimeout(() => {
                        closeToast(id);
                    }, 5000);
                });
            });
        </script>

        <script type="module">
            import { createChat } from "https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js";

            createChat({
                webhookUrl:
                    "http://localhost:5678/webhook/ae12f1a8-67cc-44f9-9456-fbfbdbc96ff2/chat",
            });
        </script>

        {% block script %} {% endblock script %}
    </body>
</html>
