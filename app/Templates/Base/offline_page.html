{% extends "Base/base.html" %} {% block title %} You Are Offline {% endblock %}
{% load humanize %} {% load static %} {% block main_block %}

<h1>You Are Offline</h1>
{% endblock main_block %} {% comment %} # def image_compress(filepath): #
print("Hello world") # size = 2 * 1024 * 1024 # file_size =
os.path.getsize(filepath) # print(file_size) # if file_size < size: #
print(filepath) # else: # img = Image.open(filepath) # folder, name =
os.path.split(filepath) # base, ext = os.path.splitext(name) # new_file =
os.path.join(folder, f"{base}_compressed{ext}") # while True: #
img.save(new_file,optimize=True,quality=95) # new_size =
os.path.getsize(new_file) # if new_size < size : # break # return new_file #
image_compress("demo.jpg") # Django Class Base View # def
function_name(demo,*args): # print(demo) # function_name() # def
job_detail_print(request,job_id): # print(job_id) # try: # item =
Job_detail.objects.get(id = job_id) # data = { # 'id': item.id, # 'description':
item.correction, # } # return JsonResponse(data) # except
Job_detail.DoesNotExist: # return JsonResponse({'error': 'Item not found'},
status=404) # email = EmailMessage( # 'Subject of the email', # 'Body of the
email', # 'sender@example.com', # From email address #
['recipient@example.com'], # To email address(es) # ) # # Attach each file # for
uploaded_file in attachments: # email.attach(uploaded_file.name,
uploaded_file.read(), uploaded_file.content_type) # email.send() # return
render(request, 'success.html') # def check_user_active_session(user_id): # try:
# user = User.objects.get(pk=user_id) # Retrieve the User object by ID # except
User.DoesNotExist: # # Handle the case where no user with that ID exists #
return False # # Check for active sessions associated with this user # sessions
= Session.objects.filter(expire_date__gt=datetime.now()) # Filter for active
sessions # for session in sessions: # decoded_session = session.get_decoded() #
Decode the session data # if decoded_session.get('_auth_user_id') == user.id: #
Check if the session belongs to the given user # return True # User is currently
logged in via an active session # return False # # views.py # import os # import
io # from django.shortcuts import redirect, render # from django.conf import
settings # from django.core.files.storage import default_storage # from
google_auth_oauthlib.flow import Flow # from googleapiclient.discovery import
build # from googleapiclient.http import MediaIoBaseUpload # from
django.views.decorators.csrf import csrf_exempt # # Scopes for Drive # SCOPES =
['https://www.googleapis.com/auth/drive.file'] # # Temp in-memory user session
token storage (for demo) # user_credentials = {} # def authorize(request): #
flow = Flow.from_client_config( # { # "web": { # "client_id":
settings.GOOGLE_OAUTH2_CLIENT_ID, # "client_secret":
settings.GOOGLE_OAUTH2_CLIENT_SECRET, # "redirect_uris":
[settings.GOOGLE_OAUTH2_REDIRECT_URI], # "auth_uri":
"https://accounts.google.com/o/oauth2/auth", # "token_uri":
"https://oauth2.googleapis.com/token", # } # }, # scopes=SCOPES, # ) #
flow.redirect_uri = settings.GOOGLE_OAUTH2_REDIRECT_URI # authorization_url,
state = flow.authorization_url( # access_type='offline', #
include_granted_scopes='true', # prompt='consent' # ) # request.session['state']
= state # return redirect(authorization_url) # def oauth2callback(request): #
state = request.session['state'] # flow = Flow.from_client_config( # { # "web":
{ # "client_id": settings.GOOGLE_OAUTH2_CLIENT_ID, # "client_secret":
settings.GOOGLE_OAUTH2_CLIENT_SECRET, # "redirect_uris":
[settings.GOOGLE_OAUTH2_REDIRECT_URI], # "auth_uri":
"https://accounts.google.com/o/oauth2/auth", # "token_uri":
"https://oauth2.googleapis.com/token", # } # }, # scopes=SCOPES, # state=state #
) # flow.redirect_uri = settings.GOOGLE_OAUTH2_REDIRECT_URI #
flow.fetch_token(authorization_response=request.build_absolute_uri()) #
credentials = flow.credentials # # Save credentials for later use #
request.session['credentials'] = { # 'token': credentials.token, #
'refresh_token': credentials.refresh_token, # 'token_uri':
credentials.token_uri, # 'client_id': credentials.client_id, # 'client_secret':
credentials.client_secret, # 'scopes': credentials.scopes # } # return
redirect('upload_file') # @csrf_exempt # def upload_file(request): # if
request.method == 'POST': # file = request.FILES['file'] # credentials_data =
request.session.get('credentials') # if not credentials_data: # return
redirect('authorize') # from google.oauth2.credentials import Credentials #
credentials = Credentials( # **credentials_data # ) # service = build('drive',
'v3', credentials=credentials) # file_metadata = {'name': file.name} # media =
MediaIoBaseUpload(file, mimetype=file.content_type) # uploaded_file =
service.files().create( # body=file_metadata, # media_body=media, # fields='id'
# ).execute() # return render(request, 'upload.html', { # 'message': f"File
uploaded successfully to Google Drive with ID: {uploaded_file.get('id')}" # }) #
return render(request, 'upload.html') # import re # from django.shortcuts import
redirect # from django.contrib import messages # from .models import CDRDetail #
from .google_drive_service import get_drive_service, create_company_folder # def
cdr_add(request): # if request.method == 'POST': # company_name =
request.POST.get('company_name') # company_email =
request.POST.get('company_email') # cdr_upload_date =
request.POST.get('cdr_upload_date') # cdr_files =
request.FILES.getlist('cdr_files') # assuming multiple files # # Validate
required fields # required_fields = { # 'Company Name': company_name, # 'Company
Email': company_email, # 'Upload Date': cdr_upload_date, # } # for field_name,
value in required_fields.items(): # if not value: # messages.error(request,
f'{field_name} is required.') # return redirect('company_add_page') # # Check
for existing email # if
CDRDetail.objects.filter(company_email=company_email).exists(): #
messages.error(request, "Company Email already exists.",
extra_tags='custom-success-style') # return redirect('company_add_page') # #
Create database record # cdr_upload = CDRDetail.objects.create( #
date=cdr_upload_date, # company_email=company_email, # company_name=company_name
# ) # # Google Drive folder creation # try: # service = get_drive_service() #
parent_folder_id = 'YOUR_PARENT_FOLDER_ID' # Replace with your actual parent
folder ID # folder_id, folder_link = create_company_folder(service,
company_name, parent_folder_id) # # Save folder link #
cdr_upload.google_drive_folder = folder_link # cdr_upload.save() # except
Exception as e: # messages.error(request, f"Google Drive folder creation failed:
{str(e)}") # return redirect('company_add_page') # messages.success(request,
"New company added successfully.") # return redirect('company_add_page') #
return redirect('company_add_page') # import os # import pickle # from
google_auth_oauthlib.flow import InstalledAppFlow # from
googleapiclient.discovery import build # SCOPES =
['https://www.googleapis.com/auth/drive.file'] # def get_drive_service(): #
creds = None # if os.path.exists('token.pickle'): # with open('token.pickle',
'rb') as token: # creds = pickle.load(token) # if not creds or not creds.valid:
# flow = InstalledAppFlow.from_client_secrets_file('credentials.json', SCOPES) #
creds = flow.run_local_server(port=0) # with open('token.pickle', 'wb') as
token: # pickle.dump(creds, token) # return build('drive', 'v3',
credentials=creds) # def create_company_folder(service, company_name,
parent_folder_id=None): # file_metadata = { # 'name': company_name, #
'mimeType': 'application/vnd.google-apps.folder', # } # if parent_folder_id: #
file_metadata['parents'] = [parent_folder_id] # folder =
service.files().create(body=file_metadata, fields='id').execute() # folder_id =
folder.get('id') # folder_link =
f"https://drive.google.com/drive/folders/{folder_id}" # return folder_id,
folder_link # ajax part # def get_company_data(request): # company_name =
request.GET.get('company_name') # if company_name: # jobs = list( #
CDRDetail.objects.filter(company_name=company_name) # .values('job_name') #
.distinct() # ) # email =
CDRDetail.objects.filter(company_name=company_name).values_list('company_email',
flat=True).first() # return JsonResponse({ # 'email': email, # 'jobs': jobs # })
# return JsonResponse({'error': 'Invalid request'}, status=400)import random #
The variable 'items' is provided by n8n and is a list of dicts. {% endcomment %}
