<div
    class="modal fade"
    id="PurchaseQuotationModal{{ quotation.id }}"
    tabindex="-1"
>
    <div
        class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl"
    >
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Purchase Order & Send Mail</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                ></button>
            </div>

            <form method="POST" action="{% url 'view_quotations' %}">
                {% csrf_token %}
                <input
                    type="hidden"
                    name="quotation_id"
                    value="{{ quotation.id }}"
                />
                <input
                    type="hidden"
                    name="job_count"
                    value="{{ quotation.pouch_quotation_jobs.count }}"
                />

                <div class="modal-body">
                    <!-- ===================== MAIN DETAILS (COMMON) ===================== -->
                    <h6 class="fw-bold text-primary">Purchase Order Details</h6>

                    <div class="border rounded p-3 mb-3">
                        <div class="row g-3">
                            <!-- Purchase Order Number -->
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_pouch_quotation_number"
                                        name="check_pouch_quotation_number"
                                        
                                        checked
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Quotation Number</label
                                    >
                                </div>
                                <input
                                    type="text"
                                    class="form-control"
                                    name="pouch_quotation_number"
                                    value="{{ quotation.pouch_quotation_number }}"
                                />
                            </div>
                            <!-- Delivery Date -->
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_delivery_date"
                                        name="check_delivery_date"
                                        checked
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Delivery Date</label
                                    >
                                </div>
                                <input
                                    type="date"
                                    class="form-control"
                                    name="delivery_date"
                                    value="{{ quotation.delivery_date|date:'Y-m-d' }}"
                                />
                            </div>

                            <!-- Party -->
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_party_details"
                                        name="check_party_details"
                                        checked
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Party Name</label
                                    >
                                </div>
                                <input
                                    type="text"
                                    class="form-control"
                                    value="{{ quotation.party_details.party_name }}"
                                    disabled
                                />
                                <input
                                    type="hidden"
                                    name="party_details"
                                    value="{{ quotation.party_details.id }}"
                                />
                            </div>


                            <!-- Party Email -->
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_party_email"
                                        name="check_party_email"
                                        checked
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Party Email</label
                                    >
                                </div>
                                <input
                                    type="email"
                                    class="form-control"
                                    name="party_email"
                                    value="{{ quotation.party_email.email }}"
                                />
                            </div>
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_kind_attention"
                                        name="check_kind_attention"
                                        checked
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Kind Attention</label
                                    >
                                </div>
                                <input
                                    type="text"
                                    class="form-control"
                                    name="kind_attention"
                                    
                                    
                                />
                              
                            </div>
                        </div>
                    </div>

                    <!-- ===================== JOB DETAILS (MULTIPLE) ===================== -->
                    <h6 class="fw-bold text-primary">Job Details</h6>

                    {% for job in quotation.pouch_quotation_jobs.all %}
                        <div class="border rounded p-3 mb-3 job-block">
                            <h6 class="fw-bold text-secondary">
                                Job {{ forloop.counter }}
                            </h6>

                            <!-- job id -->
                            <input type="hidden" name="job_id[]" value="{{ job.id }}">

                            <div class="row g-3">

                                <!-- Job Name -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_job_name_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">Job Name</label>
                                    </div>
                                    <input type="text"
                                        class="form-control"
                                        name="job_name_{{ job.id }}"
                                        value="{{ job.job_name }}">
                                </div>

                                <!-- Pouch Open Size -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_pouch_open_size_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">Pouch Size (Open)</label>
                                    </div>
                                    <input type="text"
                                        class="form-control"
                                        name="pouch_open_size_{{ job.id }}"
                                        value="{{ job.pouch_open_size }}">
                                </div>

                                <!-- Pouch Combination -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_pouch_combination_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">Pouch Combination</label>
                                    </div>
                                    <input type="text"
                                        class="form-control"
                                        name="pouch_combination_{{ job.id }}"
                                        value="{{ job.pouch_combination }}">
                                </div>

                                <!-- Quantity -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_quantity_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">Quantity</label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="quantity_{{ job.id }}"
                                        value="{{ job.quantity }}">
                                </div>

                                <!-- Purchase Rate -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_purchase_rate_per_kg_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">
                                            Purchase Rate / KG (₹)
                                        </label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="purchase_rate_per_kg_{{ job.id }}"
                                        value="{{ job.purchase_rate_per_kg }}">
                                </div>

                                <!-- No of Pouch / KG -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_no_of_pouch_kg_{{ job.id }}"
                                            checked>
                                        <label class="form-check-label fw-semibold">
                                            No. of Pouch / KG
                                        </label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="no_of_pouch_kg_{{ job.id }}"
                                        value="{{ job.no_of_pouch_kg }}">
                                </div>

                                <!-- Per Pouch Rate Basic -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_per_pouch_rate_basic_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">
                                            Per Pouch Rate Basic
                                        </label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="per_pouch_rate_basic_{{ job.id }}"
                                        value="{{ job.per_pouch_rate_basic }}">
                                </div>

                                <!-- Zipper Cost -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_zipper_cost_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">Zipper Cost</label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="zipper_cost_{{ job.id }}"
                                        value="{{ job.zipper_cost }}">
                                </div>

                                <!-- Pouch Charge -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_pouch_charge_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">Pouch Charge</label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="pouch_charge_{{ job.id }}"
                                        value="{{ job.pouch_charge }}">
                                </div>

                                <!-- Final Rare -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_final_rare_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">Final Rare</label>
                                    </div>
                                    <input type="number"
                                    
                                        class="form-control"
                                        name="final_rare_{{ job.id }}"
                                        value="{{ job.final_rare }}">
                                </div>

                                <!-- Minimum Quantity -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_minimum_quantity_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">
                                            Minimum Quantity
                                        </label>
                                    </div>
                                    <input type="number"
                                        class="form-control"
                                        name="minimum_quantity_{{ job.id }}"
                                        value="{{ job.minimum_quantity }}">
                                </div>

                                <!-- Pouch Type -->
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_pouch_type_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">
                                            Pouch Type
                                        </label>
                                    </div>
                                    <select class="form-select" name="pouch_type_{{ job.id }}">
                                        <option value="">Select Pouch Type</option>
                                        {% for value,label in pouch_types %}
                                            <option value="{{ value }}"
                                                {% if job.pouch_type == value %}selected{% endif %}>
                                                {{ label }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <!-- Delivery Address -->
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_delivery_address_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">
                                            Delivery Address
                                        </label>
                                    </div>
                                    <textarea class="form-control"
                                            rows="2"
                                            name="delivery_address_{{ job.id }}">{{ job.delivery_address }}</textarea>
                                </div>

                                <!-- Special Instruction -->
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input type="checkbox"
                                            class="form-check-input"
                                            name="check_special_instruction_{{ job.id }}">
                                        <label class="form-check-label fw-semibold">
                                            Special Instruction
                                        </label>
                                    </div>
                                    <textarea class="form-control"
                                            rows="2"
                                            name="special_instruction_{{ job.id }}">{{ job.special_instruction }}</textarea>
                                </div>

                            </div>
                        </div>
                    {% endfor %}


                    <h6 class="fw-bold text-primary">Other Terms</h6>

                    <div class="border rounded p-3 mb-3">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_quantity_variate"
                                        name="check_quantity_variate"
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Quantity Variation (%)</label
                                    >
                                </div>
                                <input
                                    type="text"
                                
                                    class="form-control"
                                    name="quantity_variate"
                                    value="{{ quotation.quantity_variate }}"
                                />
                            </div>

                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_freight"
                                        name="check_freight"
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Freight (₹)</label
                                    >
                                </div>
                                <input
                                    type="text"
                                
                                    class="form-control"
                                    name="freight"
                                    value="{{ quotation.freight }}"
                                />
                            </div>

                            <div class="col-md-4">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_gst"
                                        name="check_gst"
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >GST (%)</label
                                    >
                                </div>
                                <input
                                    type="text"
                                    class="form-control"
                                    name="gst"
                                    value="{{ quotation.gst }}"
                                />
                            </div>

                            <div class="col-md-12">
                                <div class="form-check">
                                    <input
                                        type="checkbox"
                                        class="form-check-input"
                                        id="check_note"
                                        name="check_note"
                                    />
                                    <label class="form-check-label fw-semibold"
                                        >Note</label
                                    >
                                </div>
                                <textarea class="form-control" name="note">
                                    {{ quotation.note }}</textarea
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-info" data-bs-dismiss="modal">
                        Close
                    </button>

                    <button
                        class="btn btn-primary"
                        name="create_purchase_order"
                        type="submit"
                    >
                        Create Purchase Order
                    </button>

                    <button
                        class="btn btn-success"
                        name="send_quotation_mail"
                        type="submit"
                    >
                        Send Mail
                    </button>

                    <button
                        class="btn btn-dark"
                        name="print_quotation"
                        type="submit"
                        formtarget="_blank"
                    >
                        Print Quotation
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
