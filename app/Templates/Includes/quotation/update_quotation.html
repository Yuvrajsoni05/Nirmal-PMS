<div class="modal fade" id="editQuotationModal{{ quotation.id }}" data-bs-backdrop="static" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">

      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="quotation_id" value="{{ quotation.id }}">
        <input type="hidden" name="job_count" value="{{ quotation.pouch_quotation_jobs.count }}">

        <!-- Header -->
        <div class="modal-header border-bottom">
          <h5 class="modal-title fw-bold text-dark">
            Edit Quotation - #{{ quotation.id }}
          </h5>
          <button type="reset" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <!-- Quotation Details -->
          <h6 class="fw-bold text-dark mb-3">Quotation Details</h6>

          <div class="border p-3 mb-4 rounded">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label fw-bold">Quotation Number</label>
                <input type="text" class="form-control"
                       name="pouch_quotation_number"
                       value="{{ quotation.pouch_quotation_number }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Delivery Date</label>
                <input type="date" class="form-control"
                       name="delivery_date"
                       value="{{ quotation.delivery_date|date:'Y-m-d' }}" required>
                </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Party</label>
                <input type="text"
                       class="form-control bg-light text-dark"
                       value="{{ quotation.party_details.party_name }}"
                       style="white-space: normal; word-break: break-word;"
                       readonly>
                <input type="hidden" name="party_details"
                       value="{{ quotation.party_details.id }}">
              </div>
            </div>
          </div>

          <!-- Job Details -->
          <h6 class="fw-bold text-dark mb-3">Job Details</h6>

          {% for job in quotation.pouch_quotation_jobs.all %}
          <div class="border p-3 mb-4 rounded">

            <h6 class="fw-bold text-dark mb-3">
              Job {{ forloop.counter }}
            </h6>

            <input type="hidden" name="job_id" value="{{ job.id }}">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label fw-bold">Job Name</label>
                <input type="text" class="form-control"
                       name="job_name"
                       value="{{ job.job_name }}" readonly required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Pouch Open Size</label>
                <input type="text" class="form-control"
                       name="pouch_open_size"
                       value="{{ job.pouch_open_size }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Pouch Combination</label>
                <input type="text" class="form-control"
                       name="pouch_combination"
                       value="{{ job.pouch_combination }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Quantity</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="quantity"
                       value="{{ job.quantity }}" required>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-bold">Purchase Rate Per KG</label>
                <div class="input-group">
                  <input type="text" class="form-control"
                         name="purchase_rate_per_kg"
                         value="{{ job.purchase_rate_per_kg }}" required>

                  <select class="form-select" name="polyester_units">
                    <option value="">Polyester Unit</option>
                    {% for value,label in polyester_units %}
                    <option value="{{ value }}"
                      {% if job.polyester_unit == value %}selected{% endif %}>
                      {{ label }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">No of Pouch Per KG</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="no_of_pouch_kg"
                       value="{{ job.no_of_pouch_kg }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Rate Basic</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="per_pouch_rate_basic"
                       value="{{ job.rate_basic }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Zipper Cost</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="zipper_cost"
                       value="{{ job.zipper_cost }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Pouch Charge</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="pouch_charge"
                       value="{{ job.pouch_charge }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Final Rate</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="final_rate"
                       value="{{ job.final_rate }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Minimum Quantity</label>
                <input type="number" step="0.01"
                       class="form-control"
                       name="minimum_quantity"
                       value="{{ job.minimum_quantity }}" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Pouch Type</label>
                <select class="form-select" name="pouch_type" required>
                  <option disabled>Select Pouch Type</option>
                  {% for value,label in pouch_types %}
                  <option value="{{ value }}"
                    {% if job.pouch_type == value %}selected{% endif %}>
                    {{ label }}
                  </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-bold">Delivery Address</label>
                <textarea class="form-control"
                          rows="3"
                          name="delivery_address"
                          required>{{ job.delivery_address }}</textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-bold">Special Instruction</label>
                <textarea class="form-control"
                          rows="3"
                          name="special_instruction">{{ job.special_instruction }}</textarea>
              </div>

            </div>
          </div>
          {% endfor %}

          <!-- Other Terms -->
          <h6 class="fw-bold text-dark mb-3">Other Terms</h6>

          <div class="border p-3 rounded">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label fw-bold">Quantity Variation</label>
                <input type="text" class="form-control"
                       name="quantity_variate"
                       value="{{ quotation.quantity_variate }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Freight</label>
                <input type="text" class="form-control"
                       name="freight"
                       value="{{ quotation.freight }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">GST (%)</label>
                <input type="text" class="form-control"
                       name="gst"
                       value="{{ quotation.gst }}">
              </div>

              <div class="col-12">
                <label class="form-label fw-bold">Note</label>
                <textarea class="form-control"
                          rows="3"
                          name="note">{{ quotation.note }}</textarea>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-bold">Pouch Status</label>
                <select class="form-select" name="pouch_status" required>
                  <option>Select Status</option>
                  {% for value,label in pouch_status %}
                  <option value="{{ value }}"
                    {% if quotation.pouch_status == value %}selected{% endif %}>
                    {{ label }}
                  </option>
                  {% endfor %}
                </select>
              </div>

            </div>
          </div>

        </div>

        <!-- Footer -->
        <div class="modal-footer border-top">
          <button type="submit" name="edit_quotation" class="btn btn-primary">
            Update
          </button>
          <button type="reset" class="btn btn-secondary">
            Reset
          </button>
          <button type="button" class="btn btn-outline-secondary"
                  data-bs-dismiss="modal">
            Close
          </button>
        </div>

      </form>
    </div>
  </div>
</div>  