<div class="modal fade" id="editQuotationModal{{ quotation.id }}" data-bs-backdrop="static" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content border-0 shadow">

      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="quotation_id" value="{{ quotation.id }}">
        <input type="hidden" name="job_count" value="{{ quotation.pouch_quotation_jobs.count }}">

        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold text-primary">
            Edit Quotation - #{{ quotation.id }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <!-- Purchase Order -->
          <h6 class="fw-bold text-primary mb-2">Purchase Order Details</h6>

          <div class="border rounded-3 p-3 mb-4 bg-light">
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Quotation Number</label>
                <input type="text" class="form-control" name="pouch_quotation_number" value="{{ quotation.pouch_quotation_number }}">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Delivery Date</label>
                <input type="date" class="form-control" name="delivery_date"
                  value="{{ quotation.delivery_date|date:'Y-m-d' }}">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Party Email</label>
                <input type="text" class="form-control" name="party_email" value="{{ quotation.party_email.email }}">
                <input type="hidden" name="party_email_id" value="{{ quotation.party_email.id }}">
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Party</label>
                <input type="text" class="form-control bg-secondary-subtle" value="{{ quotation.party_details.party_name }}" disabled>
                <input type="hidden" name="party_details" value="{{ quotation.party_details.id }}">
              </div>

            </div>
          </div>

          <!-- Jobs -->
          <h6 class="fw-bold text-primary mb-2">Job Details</h6>

          {% for job in quotation.pouch_quotation_jobs.all %}
          <div class="border rounded-3 p-3 mb-4">

            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="fw-bold text-secondary mb-0">Job {{ forloop.counter }}</h6>
            </div>

            <input type="hidden" name="job_id" value="{{ job.id }}">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label fw-semibold">Job Name</label>
                <input type="text" class="form-control" name="job_name" value="{{ job.job_name }}" readonly>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Pouch Size (Open)</label>
                <input type="text" class="form-control" name="pouch_open_size" value="{{ job.pouch_open_size }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Pouch Combination</label>
                <input type="text" class="form-control" name="pouch_combination" value="{{ job.pouch_combination }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Quantity</label>
                <input type="number" step="0.01" class="form-control" name="quantity" value="{{ job.quantity }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Purchase Rate / KG</label>
                <input type="number" step="0.01" class="form-control" name="purchase_rate_per_kg" value="{{ job.purchase_rate_per_kg }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">No. of Pouch / KG</label>
                <input type="number" step="0.01" class="form-control" name="no_of_pouch_kg" value="{{ job.no_of_pouch_kg }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Per Pouch Rate</label>
                <input type="number" step="0.01" class="form-control" name="per_pouch_rate_basic" value="{{ job.per_pouch_rate_basic }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Zipper Cost</label>
                <input type="number" step="0.01" class="form-control" name="zipper_cost" value="{{ job.zipper_cost }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Pouch Charge</label>
                <input type="number" step="0.01" class="form-control" name="pouch_charge" value="{{ job.pouch_charge }}">
              </div>
              
              <div class="col-md-4">
                <label class="form-label fw-semibold">Final Rare</label>
                <input type="number" step="0.01" class="form-control" name="final_rare" value="{{ job.final_rare }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Minimum Quantity</label>
                <input type="number" step="0.01" class="form-control" name="minimum_quantity" value="{{ job.minimum_quantity }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Pouch Type</label>
                <select class="form-select" name="pouch_type">
                  <option disabled>Select Pouch Type</option>
                  {% for value,label in pouch_types %}
                  <option value="{{ value }}" {% if job.pouch_type == value %} selected {% endif %}>
                    {{ label }}
                  </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Delivery Address</label>
                <textarea class="form-control" rows="4" name="delivery_address">{{ job.delivery_address }}</textarea>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold">Special Instruction</label>
                <textarea class="form-control" rows="4" name="special_instruction">{{ job.special_instruction }}</textarea>
              </div>

            </div>
          </div>
          {% endfor %}

          <!-- Other Terms -->
          <h6 class="fw-bold text-primary mb-2">Other Terms</h6>

          <div class="border rounded-3 p-3 bg-light">

            <div class="row g-3">

              <div class="col-md-4">
                <label class="form-label fw-semibold">Quantity Variation (%)</label>
                <input type="number" step="0.01" class="form-control" name="quantity_variate" value="{{ quotation.quantity_variate }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Freight (â‚¹)</label>
                <input type="number" step="0.01" class="form-control" name="freight" value="{{ quotation.freight }}">
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">GST (%)</label>
                <input type="number" class="form-control" name="gst" value="{{ quotation.gst }}">
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold">Note</label>
                <textarea class="form-control" rows="3" name="note">{{ quotation.note }}</textarea>
              </div>

            </div>
          </div>

        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="reset" class="btn btn-secondary">Reset</button>
          <button type="submit" name="edit_quotation" class="btn btn-primary px-4">Update</button>
        </div>

      </form>
    </div>
  </div>
</div>
