{% extends "Base/base.html" %}
{% load static %}
{% load humanize %}
{% load custom_tags %}

{% block styles %}
<style>
    .sticky-left {
        position: sticky;
        left: 0;
        background: #fff;
        z-index: 2;
    }
    .sticky-right {
        position: sticky;
        right: 0;
        background: #fff;
        z-index: 2;
    }
</style>
{% endblock styles %}

{% block main_block %}
<div class="container-fluid py-4">

    <!-- PAGE TITLE -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="fw-bold mb-0">View Master Data</h3>
    </div>

    <!-- ðŸ” SEARCH / FILTER CARD -->
    <div class="card mb-3">
        <div class="card-body border-bottom">
            <form method="GET" action="{% url 'view_master_data' %}">
                <div class="row g-3 align-items-end">

                    <!-- Party Name -->
                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Party Name</label>
                        <select name="search_party_name" class="form-select">
                            <option value="">All Parties</option>
                            {% for party in party_name %}
                                <option value="{{ party.party_name }}"
                                    {% if request.GET.search_party_name == party.party_name %}selected{% endif %}>
                                    {{ party.party_name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Job Name -->
                    <div class="col-md-4">
                        <label class="form-label fw-semibold">Job Name</label>
                        <select name="search_job_name" class="form-select">
                            <option value="">All Jobs</option>
                            {% for job in job_name %}
                                <option value="{{ job }}"
                                    {% if request.GET.search_job_name == job %}selected{% endif %}>
                                    {{ job }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Buttons -->
                    <div class="col-md-4 d-flex gap-2">
                        <button type="submit" name="search_pouch_master" class="btn btn-primary">
                            <i class="fa fa-search"></i>
                        </button>
                        <button type="submit" name="download_data" value="1" class="btn btn-success">
                            <i class="fa fa-download"></i> Download
                        </button>
                        <a href="{{ request.path }}" class="btn btn-outline-secondary">
                            Reset
                        </a>
                    </div>

                </div>
            </form>
        </div>
    </div>

    <!-- ðŸ“‹ TABLE + CREATE QUOTATION FORM -->
    <div class="card">
        <div class="card-body p-0">

            <form method="POST" action="{% url 'view_master_data' %}">
                {% csrf_token %}
                <!-- ACTION BUTTONS -->
                <div class="p-3">
                    <button type="submit"
                            name="create_quotation"
                            value="1"
                            class="btn btn-warning me-2">
                        <i class="fa fa-file-text"></i> Create Quotation
                    </button>

                    <button type="submit"
                            name="create_purchase_order"
                            value="1"
                            class="btn btn-primary">
                        <i class="fa fa-file-text"></i> Create Purchase Order
                    </button>
                </div>

                <!-- TABLE -->
                <div class="table-responsive">
                    <table class="table table-striped text-center text-nowrap align-middle mb-0">
                        <thead class="thead-light">
                            <tr class="text-nowrap">
                                <th>Select</th>
                                <th class="sticky-left">Sr No</th>
                                <th>Party Name</th>
                                <th>Party Contact</th>
                                <th>Party Email</th>
                                <th>Job Name</th>
                                <th>Purchase Rate Per KG</th>
                                <th>Pouch Open Size</th>
                                <th>Pouch Combination</th>
                                <th>No of Pouch / KG</th>
                                <th>Minimum Qty</th>
                                <th class="sticky-right">Actions</th>
                            </tr>
                        </thead>

                        <tbody>
                        {% if pouch_master_data %}
                            {% for pouch_master in pouch_master_data %}
                            <tr>

                                <!-- CHECKBOX -->
                                <td>
                                    <input type="checkbox"
                                           name="create_quotation_id"
                                           value="{{ pouch_master.id }}">
                                </td>

                                <td class="sticky-left">{{ forloop.counter }}</td>
                                <td>{{ pouch_master.party_details.party_name }}</td>
                                <td>{{ pouch_master.party_contact.party_number }}</td>
                                <td>{{ pouch_master.party_email.email }}</td>
                                <td>{{ pouch_master.job_name }}</td>
                                <td>{{ pouch_master.purchase_rate_per_kg }}</td>
                                <td>{{ pouch_master.pouch_open_size }}</td>
                                <td>{{ pouch_master.pouch_combination }}</td>
                                <td>{{ pouch_master.no_of_pouch_per_kg }}</td>
                                <td>{{ pouch_master.minimum_quantity }}</td>

                                <!-- ACTIONS -->
                                <td class="sticky-right">

                                    <!-- DELETE -->
                          
                                
                                        <button type="submit"
                                                name="delete_pouch_master"
                                                value="{{ pouch_master.id }}"
                                                class="btn btn-outline-danger">
                                            <i class="fa fa-trash"></i>
                                        </button>
                          

                                    <!-- EDIT -->
                                    <button type="button"
                                            class="btn btn-outline-primary"
                                            data-bs-toggle="modal"
                                            data-bs-target="#editModal{{ pouch_master.id }}">
                                        <i class="fa fa-edit"></i>
                                    </button>

                                </td>
                            </tr>

                            {% include 'Includes/master_data/edit.html' %}
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="11" class="text-center py-5 text-muted">
                                    <i class="fa fa-inbox fa-2x mb-2"></i><br>
                                    No data available
                                </td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>

            </form>
        </div>
    </div>

    <!-- ðŸ“„ PAGINATION -->
    {% include 'Includes/master_data/navbar.html' %}

</div>
{% endblock main_block %}
