{% extends 'base/base.html' %} {% load static %} {% block main_block %}
<div class="page-inner">
    <div
        class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4"
    >
        <div>
            <h3 class="fw-bold mb-3">Create Quotation</h3>
        </div>
    </div>
    {% include "Includes/quotation/form.html" %}
</div>

{% endblock main_block %} 

{% block script %}
<script src="{% static 'js/quotation.js' %}"></script>
<script src="{% static 'js/ajax/quotation.js' %}"></script>

<script>
    const pouchRateAjaxUrl = "{% url 'quotation_page_ajax' %}";
</script>

<script>
document.addEventListener("DOMContentLoaded", function(){

    const container = document.getElementById("jobs-container");
    const addBtn = document.getElementById("add-job");

    // add job
    addBtn.addEventListener("click", () => {
        let job = document.querySelector(".job-block");
        let clone = job.cloneNode(true);

        clone.querySelectorAll("input, textarea, select").forEach(el => el.value = "");
        container.appendChild(clone);
    });

    // remove job
    document.addEventListener("click", e => {
        if(e.target.classList.contains("remove-job")){
            let jobs = document.querySelectorAll(".job-block");
            if(jobs.length === 1){
                alert("At least one job is required");
                return;
            }
            e.target.closest(".job-block").remove();
        }
    });

    // auto calc per pouch rate
    document.addEventListener("input", e => {
        let block = e.target.closest(".job-block");
        if(!block) return;

        let rate = block.querySelector(".prkg").value || 0;
        let nopkg = block.querySelector(".nopkg").value || 0;
        let output = block.querySelector(".per_pouch_basic");

        output.value = (rate && nopkg) ? (rate / nopkg).toFixed(2) : "";
    });

});
</script>

{% endblock script %}
