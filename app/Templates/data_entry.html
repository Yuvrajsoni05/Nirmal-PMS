{% extends "Base/base.html" %}

{% block title %} Add New Data {% endblock %}
{% load humanize %}
{% load static %}
{% block style %}

{% endblock style %}

{% block main_block %}
      <div class="page-inner">
            <div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
              <div>
                <h3 class="fw-bold mb-3">Add New Job</h3> 
                <form method='post' action="{% url "import_file" %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div>
                        <label for="image" class="form-label fw-semibold text-dark">Import File</label>
                        <div class="border border-dashed rounded-3 text-center bg-light">
                            <input class="form-control  border-0 bg-transparent" type="file" id="files" name="import_file">
                            
                        </div>
                        
                    </div>
                    <button type='submit' class='btn btn-primary'>Import</button>

                </form>
              </div>
              
            </div>
        <div class="container-fluid py-2 px-1">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-12 col-xxl-12">
                <div class="card shadow-sm border-0 rounded-3">
                    <div class="card-header bg-primary text-white py-3 rounded-top">
                        <h4 class="mb-0 fw-semibold">
                            <i class="bi bi-plus-circle me-2"></i>Add New Job
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <form action="{% url 'add_data' %}" id="job_detail_form" method="post" autocomplete="off" enctype="multipart/form-data">
                            {% csrf_token %}
                            
                            <!-- Basic Information Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Basic Information</h6>
                                <div class="row g-3">
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="job_date" class="form-label fw-semibold text-dark">
                                            Date <span class="text-danger">*</span>
                                        </label>
                                        <input type="date" class="form-control  border-1" value="{% now "Y-m-d" %}"  id="job_date" name="job_date" pattern="\d{2}-\d{2}-\d{4}"  >
                                        <div class="invalid-feedback" id="job_date_error">Please provide a Date.</div>

                                    </div>
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="bill_no" class="form-label fw-semibold text-dark">
                                            Bill No. <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control border-1" id="bill_no" name="bill_no" placeholder="Enter Bill Number" >
                                        <div class="invalid-feedback" id="bill_no_error">Please provide  Bill No.</div>

                                    </div>
                                    <div class="col-12 col-lg-4">
                                        <label for="company_name" class="form-label fw-semibold text-dark">
                                            Company Name <span class="text-danger">*</span>
                                        </label>
                                           <select id="company_name" name="company_name" class="form-control form-select border-1" >
                                            <option value="">Select Company</option>
                                                {% for company in company_name  %}
                                                        <option value="{{ company.company_name }}">{{ company.company_name }}  </option>
                                                {% endfor %}
                                             <option value="other">Other</option>
                                            
                                            <input type="text" name="new_company" class="form-control  border-1" id="new_company" style="display: none;" placeholder="Enter New Company Name">
                                        </select>
                                        <div class="invalid-feedback" id="company_name_error">Please provide Company Name.</div>
                                    </div>  
                                </div>
                            </div>

                            <!-- Job Details Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Job Details</h6>
                                <div class="row g-3">
                                                <div class="col-12 col-sm-6 col-lg-4">
                                                        <label for="job_name" class="form-label fw-semibold text-dark">
                                                            Job Name <span class="text-danger">*</span>
                                                        </label>

                                                        <select id="job_name" name="job_name" class="form-control form-select border-1">
                                                            <option value="">Select Job Name</option>
                                                            {% for job in cdr_job_name %}
                                                            <option value="{{ job.job_name }}">{{ job.job_name }}</option>
                                                            {% endfor %}
                                                            <option value="others">Other</option>
                                                        </select>

                                                        <!-- Move this input outside the select -->
                                                        <input 
                                                            type="text" 
                                                            name="new_job_name" 
                                                            class="form-control border-1 mt-2" 
                                                            id="new_job_name" 
                                                            style="display: none;" 
                                                            placeholder="Enter new job name"
                                                        >

                                                        <div class="invalid-feedback" id="job_name_error">Please provide Job Name</div>
                                                    </div>

                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="job_type" class="form-label fw-semibold text-dark">
                                            Job Type <span class="text-danger">*</span>
                                        </label>
                                        <select id="job_type" name="job_type" class="form-control form-select border-1" >
                                            <option value="">Select Job Type</option>
                                            <option value="New Job">New Job</option>
                                            <option value="Damage Repair">Damage Repair</option>
                                            <option value="Job Work">Job Work</option>
                                        </select>
                                        <div class="invalid-feedback" id="job_type_error">Please provide Job Type</div>

                                    </div>
                                    <div class="col-12 col-lg-4">
                                        <label for="noc" class="form-label fw-semibold text-dark">
                                            No. of Colors <span class="text-danger">*</span>
                                        </label>
                                        <input type="textarea" class="form-control  border-1" id="noc" name="noc" placeholder="Enter Number of Colors" >
                                        <div class="invalid-feedback" id="noc_error">Please provide NOC</div>

                                    </div>
                                </div>
                            </div>


                            <!-- Cylinder Information Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Cylinder Information</h6>
                                <div class="row g-3">
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="prpc" class="form-label fw-semibold text-dark">
                                           Per Rate Per Cylinder (Purchase) <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                        <span class="input-group-text bg-light border-1">₹</span>
                                        <input type="text" class="form-control border-1" id="prpc_purchase" name="prpc_purchase"  onkeyup="formatNumberWithCommas(this)" maxlength="10" placeholder="00" >
                                        <div class="invalid-feedback" id="prpc_purchase_error">Please provide PRPC Purchase</div>
                                    </div>
                                    </div>
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="prpc_sell" class="form-label fw-semibold text-dark">
                                           Per Rate Per Cylinder (Sales) <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group">
                                        <span class="input-group-text bg-light border-1">₹</span>
                                        <input type="text" class="form-control border-1" id="prpc_sell" name="prpc_sell"  onkeyup="formatNumberWithCommas(this)" maxlength="10" placeholder="00" >
                                        <div class="invalid-feedback" id="prpc_sell_error">Please provide PRPC Sell</div>

                                    </div>
                                    </div>
                                    <div class="col-12 col-lg-4">
                                        <label class="form-label fw-semibold text-dark">
                                            Cylinder Size <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group ">
                                            <input type="number" class="form-control border-1" id="cylinder_diameter" placeholder="Diameter" step="0.01" min="0"  >
                                            <div class="invalid-feedback" id="cylinder_diameter_error">Please provide Cylinder Diameter</div>
                                            <span class="input-group-text bg-light border-1 fw-bold">×</span>
                                            <input type="number" class="form-control border-1" id="cylinder_height" placeholder="Height" step="0.01" min="0" >
                                            <div class="invalid-feedback" id="cylinder_height_error">Please provide Cylinder  Height</div>

                                        </div>
                                        <input type="hidden" id="cylinder_size" name="cylinder_size">
                                    </div>
                                </div>
                                <div class="row g-3 mt-2">
                                    <div class="col-12 col-md-4">
                                        <label for="cylinder_made_in" class="form-label fw-semibold text-dark">
                                            Cylinder Made In <span class="text-danger">*</span>
                                        </label>
                                        <select name="cylinder_select" id="cylinder_made_in" class="form-control form-select border-1">
                                            <option value="">Select Company</option>
                                            {% for i in  cylinder_company_names %}
                                                <option value="{{i.cylinder_made_in}}"> {{i.cylinder_made_in}} </option> 
                                            {% endfor %}
                                            <option value="others">Other</option>
                                        </select>
                                        

                                        
                                        <input type="text" class="form-control border-1" style="display: none;" id="cylinder_made_in_company_name" name="cylinder_made_in_company_name" placeholder="Cylinder Made In">
                                        <div class="invalid-feedback" id="cylinder_made_in_error">Please provide Cylinder Made In</div>

                                    </div>
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="cylinder_date" class="form-label fw-semibold text-dark">
                                            Cylinder Date <span class="text-danger">*</span>
                                        </label>
                                        <input type="date" class="form-control  border-1"  id="cylinder_dates" value="{% now "Y-m-d" %}" name="cylinder_date" pattern="\d{2}-\d{2}-\d{4}"  >
                                        <div class="invalid-feedback" id="cylinder_date_error">Please provide a Cylinder Date.</div>

                                    </div>
                                    <div class="col-12 col-sm-6 col-lg-4">
                                        <label for="bill_no" class="form-label fw-semibold text-dark">
                                         Cylinder Bill No. <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control border-1" id="cylinder_bill_no" name="cylinder_bill_no" placeholder="Enter Cylinder Bill Number" >
                                        <div class="invalid-feedback" id="cylinder_bill_no_error">Please provide Cylinder Bill No.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Pouch Information Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Pouch Information</h6>
                                <div class="row g-3">
                                    <div class="col-12 col-lg-3">
                                        <label class="form-label fw-semibold text-dark">
                                            Pouch Size <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group ">
                                            <input type="number" class="form-control border-1" id="pouch_diameter" placeholder="Diameter" step="0.01" min="0" >
                                            <div class="invalid-feedback" id="pouch_diameter_error">Please provide Pouch Diameter</div>
                                            <span class="input-group-text bg-light border-1 fw-bold">×</span>
                                            <input type="number" class="form-control border-1" id="pouch_height" placeholder="Height" step="0.01" min="0" >
                                            <div class="invalid-feedback" id="pouch_height_error">Please provide Pouch Height</div>
                                        </div>
                                        <input type="hidden" id="pouch_size" name="pouch_size">
                                    </div>
                                    <div class="col-12 col-lg-3">
                                        <label class="form-label fw-semibold text-dark">
                                            Pouch Open Size <span class="text-danger">*</span>
                                        </label>
                                        <div class="input-group ">
                                            <input type="number" class="form-control border-1" id="pouch_open_diameter" placeholder="Diameter" step="0.01" min="0" >
                                            <div class="invalid-feedback" id="pouch_open_diameter_error">Please provide Pouch Open Diameter</div>
                                            <span class="input-group-text bg-light border-1 fw-bold">×</span>
                                            <input type="number" class="form-control border-1" id="pouch_open_height" placeholder="Height" step="0.01" min="0" >
                                            <div class="invalid-feedback" id="pouch_open_height_error">Please provide Pouch Open Height</div>

                                        </div>
                                        <input type="hidden" id="pouch_open_size" name="pouch_open_size">
                                    </div>
                                    <div class="col-12 col-lg-6">
                                        <label for="pouch_combination" class="form-label fw-semibold text-dark">
                                            Pouch Combination (thickness) <span class="text-danger">*</span>
                                        </label>
                                    <div class="input-group ">
                                        <input type="number" class="form-control border-1" id="pouch_combination1" name = "pouch_combination1" placeholder="Combination 1" step="0.01" min="0" >
                                        <div class="invalid-feedback" id="pouch_combination1_error">Please provide Pouch Combination</div>
                                        <span class="input-group-text bg-light border-1 fw-bold">+</span>
                                        <input type="number" class="form-control border-1" id="pouch_combination2" name = "pouch_combination2" placeholder="Combination 2" step="0.01" min="0" >
                                        <div class="invalid-feedback" id="pouch_combination2_error">Please provide Pouch Combination</div>
                                        <span class="input-group-text bg-light border-1 fw-bold">+</span>
                                        <input type="number" class="form-control border-1" id="pouch_combination3" name = "pouch_combination3" placeholder="Combination 3" step="0.01" min="0" >
                                        <span class="input-group-text bg-light border-1 fw-bold">+</span>
                                        <input type="number" class="form-control border-1" id="pouch_combination4" name = "pouch_combination4" placeholder="Combination 4" step="0.01" min="0" >
                                    </div>
                                </div>
                            </div>

                            <br>
                             <!-- Job Status Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Job Status</h6>
                                <div class="row g-3">
                                    <div class="col-4">
                                        <label for="correction" class="form-label fw-semibold text-dark">
                                            Job Status <span class="text-danger">*</span>
                                        </label>
                                        <select id="job_status" name="job_status" class="form-control form-select border-1" required>
                                            <option value="">Select Job Status</option>
                                            <option style="background: #fffaeb; color: #dc6803;"  value="In Progress">In Progress</option>
                                            <option  style="background: #ecfdf3; color: #039855;" value="Close Job">Close Job</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!-- Additional Information Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">Additional Information</h6>
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label for="correction" class="form-label fw-semibold text-dark">
                                            Correction
                                        </label>
                                        <textarea class="form-control  border-1" id="correction" name="correction" rows="4" placeholder="Enter correction details or special instructions..." ></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- File Upload Section -->
                            <div class="mb-4">
                                <h6 class="text-primary fw-semibold mb-3 border-bottom pb-2">File Upload</h6>
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label for="image" class="form-label fw-semibold text-dark">Upload Image</label>
                                        <div class="border border-2 border-dashed rounded-3 p-4 text-center bg-light">
                                            <input class="form-control  border-0 bg-transparent" type="file" id="files" name="files" multiple accept=".jpeg,.png,.jpg,.ai">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex flex-column flex-sm-row gap-3 justify-content-end pt-3 border-top">
                                <a href="{% url "data_entry" %}"><button type="button" class="btn btn-outline-secondary btn-lg px-4 order-2 order-sm-1">
                                    <i class="bi bi-arrow-clockwise me-2"></i>Reset Form
                                </button></a>
                                <button type="submit" id="myButton"  class="btn btn-primary btn-lg px-4 order-1 order-sm-2">
                                    Submit Job  <span class="spinner" style="display: none;"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
  
 
  {% endblock main_block %}
 {% block script %}

<script>$("#company_name").change(function () {
    let companyName = $(this).val();
    if (companyName === "other") {
        $("#new_company").show();
    } else {
        $("#new_company").hide();
    }

    // Existing AJAX call for company name
    if (companyName) {
        $.ajax({
            url: '{% url "company_name_suggestion_job" %}',
            data: { company_name: companyName },
            success: function (data) {
                $("#job_name")
                    .empty()
                    .append('<option value="">Select Job</option>');
                $("#job_name").append('<option value="others">Other</option>');

                $.each(data.jobs, function (index, job) {
                    $("#job_name").append(
                        '<option value="' +
                            job.job_name +
                            '">' +
                            job.job_name +
                            "</option>"
                    );
                });
            },
        });
    } else {
        $("#job_name").empty().append('<option value="">Select Job</option>');
        $("#job_name").empty().append('<option value="others">Other</option>');
    }
});</script>
<script src="{% static 'js/data_entry.js' %}"></script>

{% endblock script %}

                    
